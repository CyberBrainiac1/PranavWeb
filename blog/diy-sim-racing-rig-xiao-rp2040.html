<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Budget DIY Sim Racing Rig | Pranav Emmadi</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <div class="page">
        <aside class="sidebar">
            <div class="identity">
                <h1>Pranav Emmadi</h1>
                <div class="dots" aria-hidden="true">
                    <span class="dot dot-orange"></span>
                    <span class="dot dot-green"></span>
                    <span class="dot dot-magenta"></span>
                </div>
            </div>

            <nav class="nav">
                <a class="nav-link" href="../../index.html">About</a>
                <a class="nav-link" href="../../experiences.html">Experiences</a>
                <a class="nav-link" href="../../projects.html">Projects</a>
                <a class="nav-link" href="../../bucket.html">Bucket List</a>
                <a class="nav-link" href="../../pinout.html">Pranav's Pinout Guide</a>
                <a class="nav-link active" href="../index.html">Blog</a>
            </nav>

            <div class="social">
                <a href="https://linkedin.com" target="_blank" rel="noreferrer">LinkedIn</a>
                <a href="https://discord.com" target="_blank" rel="noreferrer">Discord</a>
                <a href="mailto:emmadipranav@gmail.com">Email</a>
            </div>

            <div class="photo-card">
                <img src="../../PFP.jpg" alt="Pranav Emmadi" class="photo-img">
            </div>
        </aside>

        <main class="content blog-post">
            <article>
                <header class="post-header">
                    <time class="post-date">January 16, 2026</time>
                    <h1>Budget DIY Sim Racing Rig: Steering Wheel + Pedals with XIAO RP2040</h1>
                    <div class="post-tags">
                        <span class="post-tag">robotics</span>
                        <span class="post-tag">diy</span>
                        <span class="post-tag">simracing</span>
                        <span class="post-tag">rp2040</span>
                        <span class="post-tag">budget</span>
                    </div>
                </header>

                <section class="section">
                    <h2>Why I Built This (and Why It's Budget)</h2>
                    <p>I enjoy BeamNG because it models vehicle dynamics realistically, but commercial racing wheels and pedals are expensive. I wanted a budget-friendly setup that I could build and iterate on.</p>
                    <p>I decided to build my own controller from inexpensive parts. A small microcontroller and a couple of sensors are enough to create a functional prototype.</p>
                    <p>The approach is to start simple, validate the core inputs, and upgrade over time. This first version cost about $30 and leaves room for better sensors and mechanics later.</p>
                    <p>This post documents what I built, what works today, and what still needs refinement.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Hero desk shot]
                        </div>
                        <figcaption>Full rig on desk with BeamNG running. The steering wheel sits on the left, the throttle pedal on the right, and everything connects to the XIAO over USB.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Current Status</h2>
                    <p>This build is still a work in progress, but the current version is functional:</p>
                    <ul class="post-list">
                        <li><strong>Windows recognizes it as a game controller</strong> - it appears in <code>joy.cpl</code></li>
                        <li><strong>Steering input maps correctly</strong> - the X-axis moves left/right with the wheel</li>
                        <li><strong>Throttle input maps correctly</strong> - the Y-axis increases with pedal travel</li>
                        <li><strong>Live debugging is available</strong> - I can monitor sensor readings in the serial console while testing</li>
                        <li><strong>Games recognize it</strong> - BeamNG detects both axes and accepts the controller</li>
                    </ul>
                    <p>The missing piece is a brake pedal, which I plan to add next.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Windows joy.cpl axis test]
                        </div>
                        <figcaption>The Windows joystick test screen. Both axes are moving smoothly. Steering (X) goes left/right, throttle (Y) goes up/down. The display confirms Windows recognizes it as a proper gamepad.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Budget Parts List</h2>
                    <p>Here is the current parts list for the build:</p>
                    <ul class="post-list">
                        <li><strong>Seeed Studio XIAO RP2040</strong> - $5-8. Compact microcontroller with USB HID support</li>
                        <li><strong>Magnetic encoder on the steering shaft</strong> - $2-5. Non-contact steering position sensing</li>
                        <li><strong>EC11 rotary encoder</strong> - $1-3. Used for throttle in the current version</li>
                        <li><strong>Springs</strong> - $0-2. Return force for the pedals</li>
                        <li><strong>Jumper wires</strong> - basic wiring</li>
                        <li><strong>A box or 3D printed bracket</strong> - mounting hardware</li>
                        <li><strong>Breadboard or soldered connections</strong> - optional</li>
                        <li><strong>Screws and brackets</strong> - for mounting</li>
                    </ul>
                    <p><strong>Total cost: around $30.</strong> That is roughly one-tenth the price of a typical commercial racing wheel.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Parts laid out]
                        </div>
                        <figcaption>Parts laid out: XIAO board, magnetic encoder, EC11, springs, wire, and mounting brackets. This covers the essentials for the build.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>How I Wired It (Pinout)</h2>
                    <p>The XIAO runs at 3.3V, so everything uses 3.3V logic. A single voltage rail keeps wiring simple.</p>
                    
                    <h3>Throttle (EC11 encoder)</h3>
                    <ul class="post-list">
                        <li>GND -> XIAO GND</li>
                        <li>A pin -> XIAO D4</li>
                        <li>B pin -> XIAO D5</li>
                    </ul>

                    <h3>Steering (magnetic encoder)</h3>
                    <ul class="post-list">
                        <li>VCC -> XIAO 3V3</li>
                        <li>GND -> XIAO GND</li>
                        <li>Signal 1 -> XIAO D0</li>
                        <li>Signal 2 -> XIAO D1</li>
                    </ul>

                    <h3>Wiring Checklist (Avoid Common Issues)</h3>
                    <ul class="post-list">
                        <li><strong>Connect all grounds:</strong> tie every GND pin to XIAO GND and avoid floating grounds.</li>
                        <li><strong>Keep wires short:</strong> aim for sensor runs under 50 cm to reduce electrical noise.</li>
                        <li><strong>Avoid power cable routing:</strong> keep sensor wires away from motor power lines to reduce noise.</li>
                        <li><strong>If throttle is reversed:</strong> swap the A/B pins or invert the direction in code.</li>
                    </ul>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/wiring_diagram.png" alt="Wiring Map High Level" class="post-image">
                        <figcaption><strong>Wiring Map (High Level)</strong> - XIAO at the center, throttle encoder on D4/D5, steering encoder on D0/D1. All grounds tied together for a shared reference.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Signal Journey (From Turning the Wheel to the Game)</h2>
                    <p>Here is the signal flow when you turn the wheel and press the pedal:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>Wheel rotation.</strong> The steering shaft rotates and the magnetic encoder senses the field change.</li>
                        <li><strong>Encoder pulses.</strong> The encoders send pulses to the XIAO that indicate direction and motion.</li>
                        <li><strong>Position calculation.</strong> The XIAO counts pulses and computes position.</li>
                        <li><strong>USB HID report.</strong> About every 10 ms, it packages steering and throttle data into a standard USB HID report.</li>
                        <li><strong>OS enumeration.</strong> The operating system recognizes the device as a game controller.</li>
                        <li><strong>Game input.</strong> The game polls the HID axes and maps them to steering and throttle.</li>
                    </ol>
                    <p>Once the XIAO sends standard USB HID reports, the operating system handles the rest with no custom driver required.</p>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/signal_flowchart.png" alt="Signal Flow End to End" class="post-image">
                        <figcaption><strong>Signal Flow (End to End)</strong> - From physical rotation -> electrical pulses -> digital numbers -> USB HID report -> OS -> game. A clear chain of transformation.</figcaption>
                    </figure>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/signal_types_diagram.png" alt="Signal Types What each device outputs" class="post-image">
                        <figcaption><strong>Signal Types (What Each Device Outputs)</strong> - Magnetic encoder outputs quadrature pulses; EC11 does the same. The XIAO interprets these as counts and direction, then outputs standardized USB HID axis values.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Steering Math (Turning Numbers Into Movement)</h2>
                    <p>The steering encoder's raw range does not match the joystick axis range, so I map it in code.</p>
                    <p>The encoder outputs 0 to 900 for a full left-to-right rotation, while the joystick axis expects -32768 to 32767, so I translate the range.</p>
                    <p>Process:</p>
                    <p><strong>Step 1:</strong> Determine the center point (for example, 450 as straight ahead).</p>
                    <p><strong>Step 2:</strong> Normalize to -1.0 to 1.0, where -1 is full left and 1 is full right.</p>
                    <p><strong>Step 3:</strong> Scale by 32767 to get the joystick value.</p>

                    <div class="math-block">
                        <code>normalized = (raw_value - center) / (range / 2)<br>
normalized = clamp(normalized, -1.0, 1.0)<br>
xAxis = normalized * 32767</code>
                    </div>

                    <p>Example: if the raw value is 450 (center):</p>
                    <div class="math-block">
                        <code>normalized = (450 - 450) / (900 / 2) = 0<br>
xAxis = 0  (straight)</code>
                    </div>

                    <p>Example: if the raw value is 900 (full right):</p>
                    <div class="math-block">
                        <code>normalized = (900 - 450) / 450 = 1.0<br>
xAxis = 32767  (full right)</code>
                    </div>

                    <p>If steering needs to feel faster or slower, I adjust the scaling factors.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Steering calibration screenshot/notes]
                        </div>
                        <figcaption>Serial monitor output showing raw steering counts and the corresponding axis value being sent. Center position is stable, and the value increases smoothly as I turn.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Throttle Math (Making Discrete Clicks Feel Smooth)</h2>
                    <p>The EC11 encoder has discrete detents (about 20 per rotation). With roughly 70 degrees of pedal travel, I only get around 15 distinct positions.</p>
                    <p>If I sent those positions directly, throttle would feel stepped instead of smooth, jumping between fixed values.</p>
                    <p>Approach:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>Clamp the raw counts</strong> to 0 through 15.</li>
                        <li><strong>Map the 15 positions across the full joystick range</strong> (0 to 32767) to minimize the perceived steps.</li>
                        <li><strong>Add smoothing</strong> so the value ramps between steps.</li>
                    </ol>
                    <p>Example: at 7 of 15 detents:</p>
                    <div class="math-block">
                        <code>raw = 7<br>
normalized = 7 / 15 = 0.467 (about 47%)<br>
yAxis = 0.467 * 32767 = 15,309</code>
                    </div>

                    <p>I also add <strong>sensitivity tuning</strong>: a multiplier above 1.0 for a more responsive pedal, or below 1.0 for a smoother ramp. An exponential curve can increase response near the end of travel.</p>
                    <p><strong>Smoothing</strong> (low-pass filtering) ramps the value over a few milliseconds so the output feels continuous even with a mechanically discrete sensor.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Throttle response curve doodle]
                        </div>
                        <figcaption>Simple hand-drawn style curve showing the relationship between pedal position (x-axis) and joystick output (y-axis). The curve rises smoothly and predictably as pedal travel increases.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>INPUT_PULLUP (Why It Matters)</h2>
                    <p>When a pin is not actively driven high or low, it can float and produce unstable readings.</p>
                    <p>The fix is to pull the pin to a known state through a resistor, typically up to 3.3V. The XIAO includes internal pull-ups, so no external components are required.</p>
                    <p>Using <code>pinMode(pin, INPUT_PULLUP)</code> enables an internal resistor to 3.3V. The pin reads HIGH by default and goes LOW when the encoder pulls it to ground.</p>
                    <p>Benefits:</p>
                    <ul class="post-list">
                        <li><strong>Fewer parts.</strong> No external resistors needed on each input.</li>
                        <li><strong>Cleaner wiring.</strong> Fewer components reduce points of failure.</li>
                        <li><strong>Reliable readings.</strong> The pull-up keeps the input stable when the encoder is open.</li>
                    </ul>
                    <p>If wiring runs are very long or the environment is noisy, external pull-ups with capacitors can help. For a short, desk-scale setup, the internal pull-ups are usually sufficient.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Pull-up explanation mini diagram]
                        </div>
                        <figcaption>Simple diagram: a 3.3V rail connected through a resistor to the GPIO pin. Default state is HIGH. When the encoder grounds the pin, it goes LOW. This is INPUT_PULLUP behavior.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Reliable Pedal Return</h2>
                    <p>Initially, the pedals did not return cleanly. Friction in the linkage and gravity left them partway down, which is a problem when you release the throttle and the input does not reset.</p>
                    <p>Adding springs fixes this and provides:</p>
                    <ul class="post-list">
                        <li><strong>Return to zero.</strong> Release the pedal and it returns to a consistent resting point.</li>
                        <li><strong>Consistent feel.</strong> Press and release feel the same each cycle, which supports muscle memory.</li>
                        <li><strong>Cleaner input.</strong> The pedal settles to a clear resting position instead of creeping due to friction.</li>
                    </ul>
                    <p>Tips for springs:</p>
                    <ul class="post-list">
                        <li><strong>Ensure smooth travel.</strong> Test by hand and adjust geometry if it binds.</li>
                        <li><strong>Avoid rubbing.</strong> Keep the motion path straight to reduce friction.</li>
                        <li><strong>Use preload.</strong> A small preload removes dead zone before movement starts.</li>
                        <li><strong>Leverage matters.</strong> Mount closer to the pivot for lighter effort; farther away increases resistance.</li>
                    </ul>
                    <p>I'm still tuning spring rates and geometry, but the return behavior is already noticeably improved.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Pedal underside showing spring placement]
                        </div>
                        <figcaption>Bottom view of the pedal showing the spring mounting point, how it connects to the pedal bracket, and the routing to avoid interference. The spring is clearly visible pulling the pedal upward.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Debugging Checklist</h2>
                    <p>When something is not working, use this checklist:</p>
                    <ul class="post-list">
                        <li><strong>Check the serial monitor:</strong> Open Arduino's serial monitor and confirm that pin states toggle when you move the controls.</li>
                        <li><strong>Pins toggle but joy.cpl does not move:</strong> the sensor works, so check the USB HID code and connection.</li>
                        <li><strong>joy.cpl shows axes moving:</strong> test in BeamNG; if it still fails, rebind the controller in game settings.</li>
                        <li><strong>No response at all:</strong> recheck wiring and verify all GND pins are connected.</li>
                    </ul>
                </section>

                <section class="section coming-soon-box">
                    <h2>What's Next</h2>
                    <p>This is an early version, and several improvements are planned:</p>
                    
                    <h3>Hardware</h3>
                    <ul class="post-list">
                        <li>Refined CAD and 3D prints for cleaner mounting and improved pedal geometry.</li>
                        <li>Updated wiring diagrams for clarity and organization.</li>
                        <li>A brake pedal using a third encoder for braking input.</li>
                        <li>A smoother throttle sensor to replace mechanical detents.</li>
                        <li>A small motor for optional haptic feedback (rumble or centering force).</li>
                    </ul>

                    <h3>Budget Upgrade Path</h3>
                    <p>If you want to build this and upgrade gradually, here is a suggested order:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>First: springs and linkage</strong> - around $0-5, a large improvement.</li>
                        <li><strong>Second: smoother pedal sensor</strong> - upgrade to a smooth sensor for about $5-15.</li>
                        <li><strong>Third: stronger steering</strong> - improved geometry or bearings, about $5-20.</li>
                        <li><strong>Fourth: haptic feedback</strong> - optional motor feedback, about $10-30 depending on parts.</li>
                    </ol>
                </section>

                <section class="section">
                    <h2>Wrapping Up</h2>
                    <p>This build delivers a functional racing controller with roughly $30 in parts. It is not as refined as a $300 wheel, but it works reliably and continues to improve.</p>
                    <p>If you want to try this, start small: get the XIAO and one sensor working first, verify the signals, then iterate with springs, tuning, and mechanical improvements.</p>
                    <p>Future posts will cover the smooth throttle sensor, a brake pedal build, and CAD file releases.</p>
                </section>

                <nav class="post-nav">
                    <a href="../index.html" class="back-link">&larr; Back to Blog</a>
                </nav>
            </article>
        </main>

        <footer class="footer">
            <div class="footer-title">Get in Touch</div>
            <form class="footer-form" action="https://formspree.io/f/your-id" method="POST">
                <input type="email" name="email" placeholder="your email" required>
                <textarea name="message" placeholder="message" rows="1"></textarea>
                <button type="submit">Send</button>
            </form>
        </footer>
    </div>

    <style>
        .blog-post {
            max-width: 800px;
        }

        .post-header {
            margin-bottom: 40px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--border);
        }

        .post-date {
            font-size: 0.875rem;
            color: var(--muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .post-header h1 {
            font-size: 2.25rem;
            line-height: 1.2;
            margin-top: 16px;
            margin-bottom: 16px;
            font-family: "Instrument Serif", serif;
            font-weight: 400;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .post-tag {
            font-size: 0.8125rem;
            padding: 4px 10px;
            background: rgba(92, 242, 214, 0.1);
            border: 1px solid rgba(92, 242, 214, 0.3);
            border-radius: 4px;
            color: var(--accent);
            font-weight: 500;
        }

        .section {
            margin-bottom: 48px;
        }

        .section h2 {
            font-size: 1.75rem;
            margin-bottom: 20px;
            font-family: "Space Grotesk", sans-serif;
            font-weight: 600;
        }

        .section h3 {
            font-size: 1.25rem;
            margin-top: 24px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .post-list {
            list-style-position: outside;
            margin-left: 24px;
            margin-bottom: 16px;
        }

        .post-list li {
            margin-bottom: 12px;
            line-height: 1.6;
            color: var(--text);
        }

        .section p {
            line-height: 1.8;
            margin-bottom: 16px;
            color: var(--text);
        }

        .post-figure {
            margin: 32px 0;
            text-align: center;
        }

        .image-placeholder {
            background: linear-gradient(135deg, rgba(46, 168, 158, 0.08), rgba(43, 127, 214, 0.08));
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 60px 20px;
            margin-bottom: 12px;
            font-style: italic;
            color: var(--muted);
            font-size: 0.95rem;
        }

        .post-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid var(--border);
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .post-figure figcaption {
            font-size: 0.9375rem;
            color: var(--muted);
            line-height: 1.5;
            font-style: italic;
        }

        .math-block {
            background: rgba(92, 242, 214, 0.08);
            border-left: 4px solid var(--accent);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 4px;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            color: var(--accent);
            line-height: 1.6;
        }

        .coming-soon-box {
            background: rgba(92, 242, 214, 0.08);
            border: 2px solid rgba(92, 242, 214, 0.3);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 48px;
        }

        .coming-soon-box h2 {
            margin-top: 0;
        }

        .coming-soon-box h3 {
            margin-top: 20px;
        }

        .coming-soon-box p {
            color: var(--text);
        }

        .post-nav {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .back-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: var(--accent-2);
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }

            .section h2 {
                font-size: 1.5rem;
            }

            .blog-post {
                max-width: 100%;
            }
        }
    </style>
</body>
</html>
