<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Budget DIY Sim Racing Rig | Pranav Emmadi</title>
    <link rel="stylesheet" href="../../styles.css">
</head>
<body>
    <div class="page">
        <aside class="sidebar">
            <div class="identity">
                <h1>Pranav Emmadi</h1>
                <div class="dots" aria-hidden="true">
                    <span class="dot dot-orange"></span>
                    <span class="dot dot-green"></span>
                    <span class="dot dot-magenta"></span>
                </div>
            </div>

            <nav class="nav">
                <a class="nav-link" href="../../index.html">About</a>
                <a class="nav-link" href="../../experiences.html">Experiences</a>
                <a class="nav-link" href="../../projects.html">Projects</a>
                <a class="nav-link" href="../../bucket.html">Bucket List</a>
                <a class="nav-link" href="../../pinout.html">Pranav's Pinout Guide</a>
                <a class="nav-link active" href="../index.html">Blog</a>
            </nav>

            <div class="social">
                <a href="https://linkedin.com" target="_blank" rel="noreferrer">LinkedIn</a>
                <a href="https://discord.com" target="_blank" rel="noreferrer">Discord</a>
                <a href="mailto:emmadipranav@gmail.com">Email</a>
            </div>

            <div class="photo-card">
                <img src="../../PFP.jpg" alt="Pranav Emmadi" class="photo-img">
            </div>
        </aside>

        <main class="content blog-post">
            <article>
                <header class="post-header">
                    <time class="post-date">January 16, 2026</time>
                    <h1>Budget DIY Sim Racing Rig: Steering Wheel + Pedals with XIAO RP2040</h1>
                    <div class="post-tags">
                        <span class="post-tag">robotics</span>
                        <span class="post-tag">diy</span>
                        <span class="post-tag">simracing</span>
                        <span class="post-tag">rp2040</span>
                        <span class="post-tag">budget</span>
                    </div>
                </header>

                <section class="section">
                    <h2>Why I Built This (and Why It's Budget)</h2>
                    <p>OK so I'm obsessed with BeamNG—it's this insanely realistic racing game where you can actually feel what bad driving does to a car. But here's the thing: actual racing wheels and pedals cost like, $300+ easy. That's not happening. I'm a broke teenager.</p>
                    <p>So I thought, what if I just... build my own? Like, could I actually slap together a real controller from cheap stuff and make it actually work? Turns out yeah, you totally can. You just need a tiny microcontroller, some sensors, and honestly not that much else.</p>
                    <p>The whole idea is <strong>buy cheap parts, make it work, then make it better</strong>. I spent like $30 total. Add a spring here, swap a sensor there, better mounting later. No giant upfront money dump, just keep improving it as I go.</p>
                    <p>This is my first post about this whole thing, and I'm gonna walk you through exactly what I did, what works, and what's still kinda sketchy.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Hero desk shot]
                        </div>
                        <figcaption>Full rig on desk, laptop running BeamNG, USB cable visible. This is the finished setup—steering wheel on the left, throttle pedal on the right, all talking to the XIAO over USB.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>What I Have Working Right Now</h2>
                    <p>Real talk: this isn't finished. It's still a work in progress and I'm constantly tweaking it. But right now, it actually works:</p>
                    <ul class="post-list">
                        <li><strong>Windows thinks it's a game controller</strong> — I plug it in and it shows up in the joy.cpl thing that Windows has for joysticks</li>
                        <li><strong>Steering actually works</strong> — turn my wheel left, the joystick goes left; turn right, it goes right</li>
                        <li><strong>Throttle works too</strong> — press the pedal, the throttle axis moves up</li>
                        <li><strong>I can still debug it while using it</strong> — I can open the serial monitor on my laptop and see what the sensors are reading while I'm driving</li>
                        <li><strong>Games actually recognize it</strong> — BeamNG sees both axes and I can drive around in the game</li>
                    </ul>
                    <p>The one thing that sucks right now? No brake. Just throttle. I'm planning to add a second pedal soon though.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Windows joy.cpl axis test]
                        </div>
                        <figcaption>The Windows joystick test screen. Both axes are moving smoothly. Steering (X) goes left/right, throttle (Y) goes up/down. The display confirms Windows recognizes it as a proper gamepad.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>The Parts (Cheap Stuff List)</h2>
                    <p>Here's literally everything I used, ordered by how broke I needed to be:</p>
                    <ul class="post-list">
                        <li><strong>Seeed Studio XIAO RP2040</strong> — $5–8. This tiny board is the brains of the whole thing. It's fast and can talk to your computer like a real controller</li>
                        <li><strong>Magnetic encoder on the steering shaft</strong> — $2–5. No moving parts wear out, just detects magnetic changes. Clean and simple</li>
                        <li><strong>EC11 rotary encoder</strong> — $1–3. These are the mechanical "clicky" things. I'm using one for throttle right now</li>
                        <li><strong>Springs</strong> — like $0–2. Just basic springs to make the pedals snap back</li>
                        <li><strong>Random wire</strong> — dirt cheap. I just used jumper wires</li>
                        <li><strong>A box or 3D printed bracket</strong> — free if you have a 3D printer, like $5–10 otherwise</li>
                        <li><strong>Breadboard or some solder stuff</strong> — $1–3, optional</li>
                        <li><strong>Screws and brackets from the hardware store</strong> — another $2–5</li>
                    </ul>
                    <p><strong>Total bill: like $30 tops.</strong> That's literally 1/10th the price of a real racing wheel. Insane, right?</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Parts laid out]
                        </div>
                        <figcaption>Everything spread out neatly: XIAO board, magnetic encoder, EC11, springs, wire, and mounting brackets. It doesn't look like much, but it's all you need.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>How I Wired It (My Pins)</h2>
                    <p>The XIAO runs at 3.3V, so everything uses 3.3V. No level shifting nonsense, just one voltage everywhere. Keeps it simple.</p>
                    
                    <h3>Throttle (EC11 thing)</h3>
                    <ul class="post-list">
                        <li>GND → XIAO GND</li>
                        <li>A pin → XIAO D4</li>
                        <li>B pin → XIAO D5</li>
                    </ul>

                    <h3>Steering (Magnetic encoder thingy)</h3>
                    <ul class="post-list">
                        <li>VCC → XIAO 3V3</li>
                        <li>GND → XIAO GND</li>
                        <li>Signal 1 → XIAO D0</li>
                        <li>Signal 2 → XIAO D1</li>
                    </ul>

                    <h3>Wiring Checklist (Don't Mess This Up)</h3>
                    <ul class="post-list">
                        <li><strong>ALL grounds connected:</strong> like seriously, all GND pins go to XIAO GND. No separate ground pins floating around.</li>
                        <li><strong>Keep wires short:</strong> try to keep sensor wires under 50cm if possible. Long wires pick up electrical noise from like, everything.</li>
                        <li><strong>Don't route next to power cables:</strong> if you add a motor later, don't let the motor power cables cross your sensor wires. That causes noise.</li>
                        <li><strong>If throttle reads backwards:</strong> just swap the A/B pins, or flip it in code. Your choice.</li>
                    </ul>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/wiring_diagram.png" alt="Wiring Map High Level" class="post-image">
                        <figcaption><strong>Wiring Map (High Level)</strong> — XIAO at the center, throttle encoder on D4/D5, steering encoder on D0/D1. All grounds tied together. Simple and clean.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Signal Journey (From Turning the Wheel to the Game)</h2>
                    <p>OK so here's what happens when you turn the steering wheel and press the pedal. It's actually pretty cool when you think about it:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>You turn the wheel.</strong> The steering shaft rotates and the magnetic encoder notices the magnetic field changing.</li>
                        <li><strong>Sensors send electrical signals.</strong> The encoders send pulses to the XIAO telling it which direction things are moving.</li>
                        <li><strong>XIAO reads and converts to numbers.</strong> It counts the pulses and figures out where everything is positioned.</li>
                        <li><strong>XIAO sends USB controller data.</strong> Every ~10ms it packages up the current steering angle and throttle and sends it over USB in a standard format.</li>
                        <li><strong>Windows recognizes it as a controller.</strong> Your computer looks at this data and says "oh this is a gamepad".</li>
                        <li><strong>BeamNG reads the controller.</strong> The game polls your controller and maps those axes to steering and throttle in the game.</li>
                    </ol>
                    <p>The cool part? Once the XIAO sends the right USB format, everything else just works. I didn't have to write any fancy driver software or anything. The OS just handles it.</p>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/signal_flowchart.png" alt="Signal Flow End to End" class="post-image">
                        <figcaption><strong>Signal Flow (End to End)</strong> — From physical rotation → electrical pulses → digital numbers → USB HID report → OS → game. A clear chain of transformation.</figcaption>
                    </figure>

                    <figure class="post-figure">
                        <img src="../../public/blog/diy-sim-rig/signal_types_diagram.png" alt="Signal Types What each device outputs" class="post-image">
                        <figcaption><strong>Signal Types (What Each Device Outputs)</strong> — Magnetic encoder outputs quadrature pulses; EC11 does the same. The XIAO interprets these as counts and direction, then outputs standardized USB HID axis values.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Steering Math (Turning Numbers Into Movement)</h2>
                    <p>OK so here's where it gets interesting. My steering wheel doesn't naturally map to the joystick axis. I gotta build that mapping myself.</p>
                    <p>My encoder gives me a number between 0 and 900, representing a full left-to-right rotation. But the joystick axis expects a number between -32768 and 32767. So I gotta translate.</p>
                    <p>Here's my process:</p>
                    <p><strong>Step 1:</strong> Figure out the center point. Let's say 450 is straight ahead (halfway).</p>
                    <p><strong>Step 2:</strong> Convert to a range of -1.0 to 1.0. That's the standard "normal" range where -1 is full left and 1 is full right.</p>
                    <p><strong>Step 3:</strong> Multiply by 32767 to get the actual joystick number.</p>

                    <div class="math-block">
                        <code>normalized = (raw_value - center) / (range / 2)<br>
normalized = clamp(normalized, -1.0, 1.0)<br>
xAxis = normalized * 32767</code>
                    </div>

                    <p>So if I'm at 450 (center):</p>
                    <div class="math-block">
                        <code>normalized = (450 - 450) / (900 / 2) = 0<br>
xAxis = 0  (straight)</code>
                    </div>

                    <p>If I'm at 900 (full right):</p>
                    <div class="math-block">
                        <code>normalized = (900 - 450) / 450 = 1.0<br>
xAxis = 32767  (full right)</code>
                    </div>

                    <p>And if I want steering to feel faster or slower, I just adjust the numbers. Easy.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Steering calibration screenshot/notes]
                        </div>
                        <figcaption>Serial monitor output showing raw steering counts and the corresponding axis value being sent. Center position is stable, and the value increases smoothly as I turn.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Throttle Math (Making Discrete Clicks Feel Smooth)</h2>
                    <p>OK so here's the problem with the EC11 encoder: it's "clicky". It has discrete detents. Like 20 per rotation. My pedal only travels 70 degrees, which means I only get about 15 distinct positions from the encoder.</p>
                    <p>If I just sent those 15 positions directly to the joystick, throttle would feel all "steppy" and weird. You'd press it and it'd jump between positions instead of smoothly increasing. That sucks.</p>
                    <p>So here's what I do:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>Clamp the raw counts</strong> to 0 to 15</li>
                        <li><strong>Spread those 15 positions across the full joystick range</strong> (0 to 32767). Even though there are only 15 clicks, spreading them out makes the jumps way less noticeable.</li>
                        <li><strong>Add smoothing</strong> so the value ramps instead of jumping instantly</li>
                    </ol>
                    <p>Example: if I'm at 7 of 15 detents:</p>
                    <div class="math-block">
                        <code>raw = 7<br>
normalized = 7 / 15 = 0.467 (about 47%)<br>
yAxis = 0.467 * 32767 = 15,309</code>
                    </div>

                    <p>Then I can also add <strong>sensitivity tuning</strong>. If I want the pedal to feel super responsive, I use a multiplier > 1.0. If I want it more gradual, I use a multiplier < 1.0. I can even add an exponential curve to make it ramp faster at the end.</p>
                    <p>Then <strong>smoothing</strong> (low-pass filtering) ramps the value over a few milliseconds. Makes it feel way more polished even though the sensor is mechanically discrete.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Throttle response curve doodle]
                        </div>
                        <figcaption>Simple hand-drawn style curve showing the relationship between pedal position (x-axis) and joystick output (y-axis). Notice the curve is smooth and rises predictably. More press = more throttle.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>INPUT_PULLUP (Why It's So Cool)</h2>
                    <p>OK so there's this thing called "floating". When a pin isn't actively being held high or low, its voltage is just... undefined. That leads to garbage readings. Not good.</p>
                    <p>The fix is to pull the pin to a known state using a resistor. Usually, pull it up to 3.3V. The XIAO has built-in resistors for this, so you don't need to add anything.</p>
                    <p>You just do <code>pinMode(pin, INPUT_PULLUP)</code> and boom—the microcontroller internally connects a resistor to 3.3V on that pin. By default it reads HIGH. When the encoder grounds the pin, it goes LOW.</p>
                    <p>Why is this awesome?</p>
                    <ul class="post-list">
                        <li><strong>Fewer parts.</strong> No external resistors needed on every single pin.</li>
                        <li><strong>Cleaner breadboard.</strong> Less stuff = less things breaking.</li>
                        <li><strong>Super reliable.</strong> The encoder grounds the pin cleanly and the pull-up ensures you always read stable HIGH otherwise.</li>
                    </ul>
                    <p>The downside? If your wires are like, meters long or in a super noisy environment, the pull-up might not be enough. Then you'd need external pull-ups with capacitors to filter noise. But for a desk setup like mine, internal pull-ups are perfect.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Pull-up explanation mini diagram]
                        </div>
                        <figcaption>Simple diagram: a 3.3V rail connected through a resistor to the GPIO pin. Default state is HIGH. When the encoder grounds the pin, it goes LOW. This is INPUT_PULLUP behavior.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Pedals That Don't Get Stuck</h2>
                    <p>So at first, my pedals were kinda bad. They didn't want to come back up on their own. They'd get stuck partway because of friction in the linkage and gravity pulling down. That's a problem when you're driving and you release the throttle but it just... stays there.</p>
                    <p>Springs fix this instantly. A good spring gives you:</p>
                    <ul class="post-list">
                        <li><strong>Return to zero.</strong> Release the pedal and it snaps back. No ambiguity.</li>
                        <li><strong>Consistent feel.</strong> Pressing feels the same every time. Returning feels the same every time. Good for muscle memory.</li>
                        <li><strong>Less weird input noise.</strong> Instead of the pedal creeping up slowly due to friction, it has a clear resting spot.</li>
                    </ul>
                    <p>Tips for springs:</p>
                    <ul class="post-list">
                        <li><strong>Make sure it moves smoothly.</strong> Test by hand first. If it gets stuck, adjust the geometry.</li>
                        <li><strong>Don't let it rub.</strong> Friction ruins consistency. A straight line is best.</li>
                        <li><strong>Preload helps.</strong> If the spring is too loose when not pressed, you'll have deadzone before things start moving.</li>
                        <li><strong>Distance from pivot = effort.</strong> Mount the spring attachment point closer to the pivot if you want easier pedal pressing. Farther = harder.</li>
                    </ul>
                    <p>I'm still tweaking spring rates and geometry, but already it's 100x better than before.</p>

                    <figure class="post-figure">
                        <div class="image-placeholder">
                            [IMAGE PLACEHOLDER: Pedal underside showing spring placement]
                        </div>
                        <figcaption>Bottom view of the pedal showing the spring mounting point, how it connects to the pedal bracket, and the routing to avoid interference. The spring is clearly visible pulling the pedal upward.</figcaption>
                    </figure>
                </section>

                <section class="section">
                    <h2>Debugging When Stuff Breaks</h2>
                    <p>When things don't work, go through this checklist:</p>
                    <ul class="post-list">
                        <li><strong>Check the serial monitor:</strong> Open Arduino's serial monitor and watch the raw pin states. Do they toggle when you move stuff around?</li>
                        <li><strong>Pins toggling but joy.cpl not moving?</strong> The sensor works, but your USB HID code is broken or the connection is bad. Check the code.</li>
                        <li><strong>joy.cpl shows axes moving?</strong> Great. Now test in BeamNG. If it doesn't work in the game, rebind the controller in game settings sometimes helps.</li>
                        <li><strong>Nothing works?</strong> Check your wiring first. Is everything actually connected? Are the GND pins really connected?</li>
                    </ul>
                </section>

                <section class="section coming-soon-box">
                    <h2>What's Next</h2>
                    <p>This is just the start. I've got a bunch of stuff planned:</p>
                    
                    <h3>Hardware Stuff</h3>
                    <ul class="post-list">
                        <li>Better CAD files and 3D prints — cleaner mounting, better pedal design</li>
                        <li>Updated wiring diagrams — cleaner and more organized</li>
                        <li>A brake pedal — add a third encoder so I actually have braking</li>
                        <li>Better throttle sensor — switch from mechanical detents to a smooth analog sensor so throttle feels actually smooth</li>
                        <li>Maybe add a small motor — for haptic feedback (like rumble when you crash, or centering force on the steering wheel)</li>
                    </ul>

                    <h3>Budget Upgrade Path</h3>
                    <p>If you wanna build this and upgrade it slowly, here's my recommendation:</p>
                    <ol class="post-list" style="list-style-type: decimal;">
                        <li><strong>First: springs + better linkage</strong> — like $0–5, huge difference. Do this first.</li>
                        <li><strong>Second: better pedal sensor</strong> — upgrade to a smooth sensor. Cost $5–15. Removes the "clickiness".</li>
                        <li><strong>Third: stronger steering</strong> — better geometry, maybe bearings. Cost $5–20.</li>
                        <li><strong>Fourth: haptic stuff</strong> — add optional motor feedback. Cost $10–30 depending on parts.</li>
                    </ol>
                </section>

                <section class="section">
                    <h2>Wrapping Up</h2>
                    <p>So yeah, I built a working racing controller from like $30 worth of parts. It's not as fancy as a $300 wheel, but it actually works and I'm constantly making it better.</p>
                    <p>If you wanna try this, start small. Get the XIAO and one sensor working first. Make sure the signals are good. Then iterate from there. Add springs, tune the response, improve the mechanical stuff. That's how you build something good without spending tons of money.</p>
                    <p>I'm planning more posts about adding the smooth throttle sensor, building the brake pedal, and sharing the CAD files. So stay tuned I guess.</p>
                </section>

                <nav class="post-nav">
                    <a href="../index.html" class="back-link">← Back to Blog</a>
                </nav>
            </article>
        </main>

        <footer class="footer">
            <div class="footer-title">Get in Touch</div>
            <form class="footer-form" action="https://formspree.io/f/your-id" method="POST">
                <input type="email" name="email" placeholder="your email" required>
                <textarea name="message" placeholder="message" rows="1"></textarea>
                <button type="submit">Send</button>
            </form>
        </footer>
    </div>

    <style>
        .blog-post {
            max-width: 800px;
        }

        .post-header {
            margin-bottom: 40px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--border);
        }

        .post-date {
            font-size: 0.875rem;
            color: var(--muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .post-header h1 {
            font-size: 2.25rem;
            line-height: 1.2;
            margin-top: 16px;
            margin-bottom: 16px;
            font-family: "Instrument Serif", serif;
            font-weight: 400;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .post-tag {
            font-size: 0.8125rem;
            padding: 4px 10px;
            background: rgba(92, 242, 214, 0.1);
            border: 1px solid rgba(92, 242, 214, 0.3);
            border-radius: 4px;
            color: var(--accent);
            font-weight: 500;
        }

        .section {
            margin-bottom: 48px;
        }

        .section h2 {
            font-size: 1.75rem;
            margin-bottom: 20px;
            font-family: "Space Grotesk", sans-serif;
            font-weight: 600;
        }

        .section h3 {
            font-size: 1.25rem;
            margin-top: 24px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .post-list {
            list-style-position: outside;
            margin-left: 24px;
            margin-bottom: 16px;
        }

        .post-list li {
            margin-bottom: 12px;
            line-height: 1.6;
            color: var(--text);
        }

        .section p {
            line-height: 1.8;
            margin-bottom: 16px;
            color: var(--text);
        }

        .post-figure {
            margin: 32px 0;
            text-align: center;
        }

        .image-placeholder {
            background: linear-gradient(135deg, rgba(46, 168, 158, 0.08), rgba(43, 127, 214, 0.08));
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 60px 20px;
            margin-bottom: 12px;
            font-style: italic;
            color: var(--muted);
            font-size: 0.95rem;
        }

        .post-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid var(--border);
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .post-figure figcaption {
            font-size: 0.9375rem;
            color: var(--muted);
            line-height: 1.5;
            font-style: italic;
        }

        .math-block {
            background: rgba(92, 242, 214, 0.08);
            border-left: 4px solid var(--accent);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 4px;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            color: var(--accent);
            line-height: 1.6;
        }

        .coming-soon-box {
            background: rgba(92, 242, 214, 0.08);
            border: 2px solid rgba(92, 242, 214, 0.3);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 48px;
        }

        .coming-soon-box h2 {
            margin-top: 0;
        }

        .coming-soon-box h3 {
            margin-top: 20px;
        }

        .coming-soon-box p {
            color: var(--text);
        }

        .post-nav {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .back-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .back-link:hover {
            color: var(--accent-2);
        }

        @media (max-width: 768px) {
            .post-header h1 {
                font-size: 1.75rem;
            }

            .section h2 {
                font-size: 1.5rem;
            }

            .blog-post {
                max-width: 100%;
            }
        }
    </style>
</body>
</html>
